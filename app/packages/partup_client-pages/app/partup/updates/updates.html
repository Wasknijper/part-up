<template name="app_partup_updates">
    <div class="pu-composition pu-composition-partupdetailupdates {{#if newUpdatesCount }}pu-composition-partupdetailupdates-newupdatesavailable{{/if}}">

        <div class="pu-sub-timelineline" style="{{# with containerHeightVar.get }}height: {{ . }}px;{{/ with }}"></div>

        <!-- new message popup -->
        {{#if partupIsPopupActive 'new-message' }}
            {{#contentFor "PopupTitle"}}
                {{_ 'pages-app-partup-updates-newmessage-title'}}
            {{/contentFor}}
            {{#contentFor region="PopupContent" data=.}}
                {{> app_partup_updates_newmessage }}
            {{/contentFor}}
        {{/if}}

        <!-- Header buttons -->
        <header class="pu-pageheader">
            <section>
                <a class="pu-button pu-button-icon" href="#" data-newmessage-popup>
                    <i class="picon-message"></i>
                    {{_ 'pages-app-partup-updates-new_message' }}
                </a>
            </section>
            <aside>{{> PartialDropdownUpdatesActions reactiveVar=filterReactiveVar}}</aside>
        </header>

        <div data-infinitescroll-container>

            <!-- Loading/rendering state -->
            {{# if updatesLoading }}
                <section class="pu-update">
                    <aside>

                        <!-- Loader indicator where normally a user avatar would be -->
                        <figure class="pu-avatar pu-avatar-update">
                            <span class="pu-sub-image pu-sub-image-loader">
                                {{> Loader ALIGNMENT='center' COLOR='white' SIZE='small' }}
                            </span>
                        </figure>

                    </aside>
                </section>
            {{ else }}

                <!-- Reveal new updates -->
                {{#if newUpdatesCount }}
                    <p class="pu-update pu-sub-revealupdatesbutton">
                        <aside></aside>
                        <section><a href="#" data-reveal-new-updates class="pu-button pu-button-bluebar">{{_ 'pages-app-partup-updates-revealupdates' count=newUpdatesCount }}</a></section>
                    </p>
                {{/if}}

                <!-- For each update -->
                {{#each updates }}


                    <!-- If the updates doesn't belong to the new updates, draw a line -->
                    {{# if partupEquals showNewUpdatesSeparator 'top' }}
                        <div class="pu-sub-newupdatesseparator pu-state-active">
                            <p class="pu-textline">
                                <span>
                                    {{_ 'pages-app-partup-updates-new_updates_separator' }}
                                    <i class="picon-arrow-up"></i>
                                </span>
                            </p>
                        </div>
                    {{/ if }}

                    <!-- If it's another day, show a day-separator -->
                    {{#if isAnotherDay }}
                        <section class="pu-sub-separator">
                            {{ partupDatePartupTimeline updated_at }}
                            <i class="picon-arrow-down"></i>
                        </section>
                    {{/if }}

                    <!-- Render the update -->
                    {{> Update LINK=true COMMENT_LIMIT=2 updateId=_id metadata=metaDataForUpdate }}

                    {{# if partupEquals showNewUpdatesSeparator 'bottom' }}
                        <div class="pu-sub-newupdatesseparator pu-state-active">
                            <p class="pu-textline">
                                <span>
                                    {{_ 'pages-app-partup-updates-new_updates_separator' }}
                                    <i class="picon-arrow-up"></i>
                                </span>
                            </p>
                        </div>
                    {{/ if }}

                {{ else }}

                    <!-- No updates available -->
                    <section class="pu-update pu-update-placeholder">
                        <section>
                            <p>{{_ 'pages-app-partup-updates-no_updates'}}</p>
                        </section>
                    </section>

                {{/each }}

                <!-- Infinite scroll loader -->
                {{# if updatesLoadingMore }}
                    <section class="pu-update">
                        <aside>

                            <!-- Loader indicator where normally a user avatar would be -->
                            <figure class="pu-avatar pu-avatar-update">
                                <span class="pu-sub-image pu-sub-image-loader">
                                    {{> Loader ALIGNMENT='center' COLOR='white' SIZE='small' }}
                                </span>
                            </figure>

                        </aside>
                    </section>
                {{/ if }}

            {{/ if }}

        </div>

    </div>
</template>
